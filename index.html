<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Study Pop</title>

<!-- PWA / iOS -->
<link rel="icon" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  margin: 0;
  padding: 20px;
  font-family: system-ui;
  background: linear-gradient(135deg,#ffdde1,#ee9ca7);
  text-align: center;
}

h1 { color:#fff; }

.card {
  background:#fff;
  border-radius:20px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 10px 20px rgba(0,0,0,.15);
}

input {
  width:80%;
  padding:12px;
  font-size:16px;
  border-radius:12px;
  border:1px solid #ccc;
}

button {
  margin-top:10px;
  padding:12px 20px;
  font-size:16px;
  border:none;
  border-radius:30px;
  background:#ff7aa2;
  color:#fff;
}

.stat {
  font-size:18px;
  margin:6px 0;
}

ul {
  list-style:none;
  padding:0;
  max-height:180px;
  overflow-y:auto;
}

li {
  font-size:14px;
  padding:4px;
}

.tabs button {
  margin:5px;
  background:#ffd6e8;
  color:#333;
}

.hidden { display:none; }
</style>
</head>

<body>

<h1>ğŸ“š Study Pop</h1>

<div class="card">
  <h2>å‹‰å¼·æ™‚é–“ã‚’è¨˜éŒ²</h2>
  <input type="number" id="minutes" placeholder="ä½•åˆ†å‹‰å¼·ã—ãŸï¼Ÿ">
  <br>
  <button onclick="addStudy()">è¨˜éŒ²ã™ã‚‹</button>
</div>

<div class="card">
  <h2>ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h2>
  <div class="stat" id="total">åˆè¨ˆï¼š0 åˆ†</div>
  <div class="stat" id="month">ä»Šæœˆï¼š0 åˆ†</div>
  <div class="stat" id="streak">ğŸ”¥ é€£ç¶šï¼š0 æ—¥</div>
</div>

<div class="card">
  <div class="tabs">
    <button onclick="show('history')">ğŸ“… å±¥æ­´</button>
    <button onclick="show('graph')">ğŸ“ˆ ã‚°ãƒ©ãƒ•</button>
  </div>

  <div id="history">
    <ul id="historyList"></ul>
  </div>

  <div id="graph" class="hidden">
    <canvas id="chart"></canvas>
  </div>
</div>

<script>
const KEY = "study-pop-data";

function load() {
  return JSON.parse(localStorage.getItem(KEY)) || [];
}

function save(data) {
  localStorage.setItem(KEY, JSON.stringify(data));
}

function addStudy() {
  const min = Number(minutes.value);
  if (!min) return;

  const data = load();
  const today = new Date().toISOString().slice(0,10);
  data.push({date:today, min});
  save(data);
  minutes.value="";
  render();
}

function render() {
  const data = load();
  let total=0, month=0;
  const nowMonth = new Date().toISOString().slice(0,7);
  const days = [...new Set(data.map(d=>d.date))].sort();

  data.forEach(d=>{
    total+=d.min;
    if(d.date.startsWith(nowMonth)) month+=d.min;
  });

  total.innerText = `åˆè¨ˆï¼š${total} åˆ†`;
  month.innerText = `ä»Šæœˆï¼š${month} åˆ†`;

  // streak
  let streak=0;
  for(let i=days.length-1;i>=0;i--){
    const diff = (new Date() - new Date(days[i]))/86400000;
    if(diff<streak+1) streak++;
    else break;
  }
  document.getElementById("streak").innerText = `ğŸ”¥ é€£ç¶šï¼š${streak} æ—¥`;

  // history
  historyList.innerHTML="";
  data.slice().reverse().forEach(d=>{
    const li=document.createElement("li");
    li.textContent=`${d.date}ï¼š${d.min} åˆ†`;
    historyList.appendChild(li);
  });

  drawChart(data);
}

let chart;
function drawChart(data){
  const daily={};
  data.forEach(d=>{
    daily[d.date]=(daily[d.date]||0)+d.min;
  });

  const labels=Object.keys(daily);
  const values=Object.values(daily);

  if(chart) chart.destroy();
  chart=new Chart(document.getElementById("chart"),{
    type:"bar",
    data:{
      labels,
      datasets:[{
        label:"å‹‰å¼·æ™‚é–“ï¼ˆåˆ†ï¼‰",
        data:values,
        backgroundColor:"#ff8fab"
      }]
    }
  });
}

function show(id){
  history.classList.add("hidden");
  graph.classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
}

render();
</script>

</body>
</html>
